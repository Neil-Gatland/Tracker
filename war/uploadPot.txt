<%@ page import="com.devoteam.tracker.model.PotSpreadsheet"%>
<!-- page import="java.util.regex.Pattern"-->
<%
String selectedCustomer = request.getParameter("selectedCustomer")==null?"":request.getParameter("selectedCustomer");
String customerName = "";
String potFileName = "";
String problems = null;
boolean errorsFound = false;
if (problemsFound) {
	problems = (String)session.getAttribute(ServletConstants.PROBLEM_ARRAY_NAME_IN_SESSION);
	session.removeAttribute(ServletConstants.PROBLEM_ARRAY_NAME_IN_SESSION);
}
String b1Title = "Upload this pot";
String b1Value = "Submit";
String b1OnClick = "uploadPotClick('uploadPotSubmit')";
if (potToUpload) {
	PotSpreadsheet sheetPot = (PotSpreadsheet)session.getAttribute(ServletConstants.POT_SPREADSHEET_NAME_IN_SESSION);
	customerName = sheetPot.getCustomerName();
	potFileName = sheetPot.getPotFileName();
	session.setAttribute(ServletConstants.POT_SPREADSHEET_COPY_NAME_IN_SESSION, sheetPot);
	session.removeAttribute(ServletConstants.POT_SPREADSHEET_NAME_IN_SESSION);
	b1Title = "Confirm upload to database";
	b1Value = "Confirm";
	b1OnClick = "uploadPotClick('uploadPotConfirm')";
} else if (problemsFound) {
	errorsFound = true;
	customerName = (String)session.getAttribute("customerName");
	potFileName = (String)session.getAttribute("potFileName");
	session.removeAttribute("customerName");
	session.removeAttribute("potFileName");
}
%>
<div id="uploadPot" class="filter" style="width:<%=problemsFound?"540":"270"%>px">
	<div class="closeX" title="close" onClick="uploadPotClick('cancel')">x</div>
	<div style="clear:both;text-align:center;overflow:hidden"><h2 class="white">Load Pot Spreadsheet</h2></div>
<%if (potToUpload || problemsFound) {%>
	<div style="padding-bottom:10px">Customer: <%=customerName%></div>
	<div style="padding-bottom:10px">File Name: <%=potFileName%></div>
<%} else {%>	
	<div>Customer</div>
	<div style="padding-bottom:10px"><%=uB.getSelectHTML("CustomerId", "select", "filter", selectedCustomer) %></div>
	<div><input type="file" style="visibility:hidden" name="potXLS" id="potXLS" onChange="showFileName(this.value)"></div>
	<div style="width:240px;margin:0 auto;">
		<input style="width:240px" type="button" class="button" onClick="selectFile()" value="Select Spreadsheet" />
	</div>	
	<div style="padding-bottom:10px" id="fileNameDisplay">&nbsp;</div>
<%}	
  if (problemsFound) {%>
	<div><%=errorsFound?"Errors":"Warnings"%>:</div>
<%	String[] messages = problems.split("\\|"); //Pattern.quote("|")
	for (int i = 0; i < messages.length; i++) {%>
	<div style="padding-bottom:10px"><%=messages[i]%></div>
<%	}
  }	
  if (potToUpload) {%>
	<div style="padding-bottom:10px">Click 'Confirm' to upload this pot or 'Cancel' to exit without uploading</div>
<%} else if (errorsFound) {%>  
	<div style="padding-bottom:10px">This pot cannot be uploaded until the errors shown have been corrected</div>
<%}%>
	<div style="width:240px;margin:0 auto;">
<%if (!errorsFound) {%>	
		<div style="float:left" title="<%=b1Title%>"><input style="width:120px" type="button" class="button" onClick="<%=b1OnClick%>" value="<%=b1Value%>" /></div>
<%}%>	
		<div style="float:left"><input style="width:120px" type="button" class="button" onClick="uploadPotClick('cancel')" value="<%=errorsFound?"Close":"Cancel"%>" /></div>
	</div>
</div>
<input type="hidden" name="potFileName" id="potFileName" value="">
<script language="javascript">
<!--
function showFileName(thisValue) {
	var fND = document.getElementById("fileNameDisplay");
	fND.innerHTML = thisValue;	
	var pFN = document.getElementById("potFileName");
	pFN.value = thisValue;	
}

function selectFile() {
	var pX = document.getElementById("potXLS");
	pX.click();	
}

function uploadPotClick(operation) {
	var f1 = document.getElementById("f1");
	if (operation == "cancel") {
		/*var uP = document.getElementById("uploadPot");
		uP.style.display = "none";
		uP.style.left = "0px";
		uP.style.top = "0px";*/
		document.getElementById("toScreen").value = "<%=ServletConstants.SCHEDULING%>";
		f1.action = "/navigation";
		f1.submit();
	} else if (operation == "uploadPotConfirm") {
		f1.action = "/uploadPot";
		f1.submit();
	} else {
		if (document.getElementById("selectCustomerId").selectedIndex < 1) {
			alert("Please select a customer");
		} else if (document.getElementById("fileNameDisplay").innerHTML == "&nbsp;") {
			alert("Please select a file to upload");
		} else {
			//alert(document.getElementById("fileNameDisplay").innerHTML);
			f1.action = "<%=blobstoreService.createUploadUrl("/validatePot")%>";
			f1.enctype="multipart/form-data";
			f1.submit();
		}
	}
}
-->
</script>

